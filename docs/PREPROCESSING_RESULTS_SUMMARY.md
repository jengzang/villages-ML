# 数据预处理结果总结

**执行日期：** 2026-02-19
**执行时间：** 约 1 分 24 秒

---

## 问题 1：对多少行村庄进行了更改？

### 总体统计

- **处理村庄总数：** 285,860 个
- **有效村庄数：** 284,764 个
- **去除行政村前缀：** 5,997 个村庄 (2.1%)
- **规范化编号村：** 4,780 个村庄 (1.7%)
- **总修改数：** 约 10,777 个村庄 (3.8%)

### 按市统计（前缀去除率）

| 市 | 总村数 | 去除前缀数 | 去除率 |
|---|--------|-----------|--------|
| 汕头市 | 4,586 | 897 | 19.56% |
| 东莞市 | 2,863 | 252 | 8.80% |
| 汕尾市 | 6,379 | 537 | 8.42% |
| 广州市 | 8,253 | 594 | 7.20% |
| 珠海市 | 1,059 | 73 | 6.89% |
| 佛山市 | 5,365 | 346 | 6.45% |
| 潮州市 | 4,944 | 301 | 6.09% |
| 其他市 | 251,315 | 2,997 | 1.19% |

**关键发现：**
- 汕头市的前缀去除率最高（19.56%），说明该地区村名中包含行政村前缀的情况最普遍
- 整体去除率（2.1%）低于预期的 20-40%，这是因为采用了保守的匹配策略，确保准确性

---

## 问题 2：更改前后的对比整理在哪？

### 详细报告位置

1. **完整审计报告：** `docs/PREFIX_CLEANING_AUDIT_REPORT.md`
   - 包含：统计数据、按市分析、最常见前缀、匹配来源分布、置信度分布
   - 包含：100 个随机抽样案例的前后对比
   - 包含：跨市消歧验证

2. **数据库审计日志表：** `prefix_cleaning_audit_log`
   - 记录了所有 284,764 个村庄的处理详情
   - 包含：原始名称、清洗后名称、去除的前缀、匹配来源、置信度

3. **预处理数据表：** `广东省自然村_预处理`
   - 存储了所有村庄的预处理结果
   - 包含：原始名称、基础清洗、去前缀、规范化、字符集

---

## 典型案例示例

### 示例 1：行政村前缀去除

| 市 | 县区 | 乡镇 | 行政村 | 原始名称 | 去前缀后 | 去除的前缀 | 置信度 |
|---|-----|------|--------|---------|---------|-----------|--------|
| 湛江市 | 雷州市 | 龙门镇 | 那尾村 | 那尾寮村 | 寮村 | 那尾 | 0.950 |
| 广州市 | 从化区 | 温泉镇 | 宣星村 | 宣星二社 | 二社 | 宣星 | 0.950 |
| 佛山市 | 南海区 | 狮山镇 | 联星社区 | 联星南房 | 南房 | 联星 | 0.800 |
| 汕头市 | 潮南区 | 仙城镇 | 利陂社区 | 利陂六座 | 六座 | 利陂 | 0.800 |

### 示例 2：编号村规范化

| 原始名称 | 规范化后 | 说明 |
|---------|---------|------|
| 东村一村 | 东村 | 去除编号后缀 "一村" |
| 南岭二 | 南岭 | 去除编号后缀 "二" |
| 宣星二社 | 宣星 | 先去前缀，再去编号 |

---

## 最常见的去除前缀（Top 20）

| 前缀 | 出现次数 | 平均置信度 |
|-----|---------|-----------|
| 田心 | 33 | 0.867 |
| 留良洞 | 23 | 0.950 |
| 石坑 | 22 | 0.916 |
| 黄田 | 21 | 0.950 |
| 红旗 | 20 | 0.832 |
| 莲塘 | 19 | 0.937 |
| 西山 | 17 | 0.906 |
| 五星 | 17 | 0.950 |
| 白沙 | 16 | 0.816 |
| 大旺 | 16 | 0.934 |

---

## 匹配来源分布

| 匹配来源 | 数量 | 百分比 | 说明 |
|---------|------|--------|------|
| same_row_exact_normalized | 4,838 | 80.67% | 同行精确匹配（规范化后） |
| same_township | 629 | 10.49% | 同乡镇内匹配 |
| same_row_candidate_prefix | 488 | 8.14% | 同行候选前缀匹配 |
| same_row_exact | 33 | 0.55% | 同行精确匹配 |
| same_row_partial_2char | 9 | 0.15% | 同行部分匹配（2字符） |

**关键发现：**
- 80.67% 的前缀去除是基于同行的行政村字段精确匹配（规范化后）
- 10.49% 是通过同乡镇内的其他行政村匹配（回退策略）
- 匹配策略保守且准确

---

## 置信度分布

| 置信度范围 | 数量 | 百分比 |
|-----------|------|--------|
| 0.9-1.0 | 4,871 | 81.2% |
| 0.8-0.9 | 488 | 8.1% |
| 0.7-0.8 | 638 | 10.6% |

**平均置信度：** 0.911

---

## 需要人工审核的案例

- **数量：** 804 个村庄 (0.28%)
- **原因：** 置信度 < 0.7，但检测到可能的前缀
- **位置：** 详见 `docs/PREFIX_CLEANING_AUDIT_REPORT.md` 中的 "Sample Cases Needing Review" 章节

---

## 查询示例

### SQL 查询 1：查看所有被清洗的村庄

```sql
SELECT
    市级, 区县级, 乡镇级, 行政村,
    自然村_原始,
    去除的前缀,
    自然村_去前缀,
    匹配来源,
    最终置信度
FROM prefix_cleaning_audit_log
WHERE 是否去除 = 1
ORDER BY 市级, 区县级, 乡镇级, 行政村;
```

### SQL 查询 2：按市统计清洗情况

```sql
SELECT
    市级,
    COUNT(*) AS 总村数,
    SUM(是否去除) AS 清洗村数,
    ROUND(100.0 * SUM(是否去除) / COUNT(*), 2) AS 清洗率,
    AVG(CASE WHEN 是否去除=1 THEN 最终置信度 END) AS 平均置信度
FROM prefix_cleaning_audit_log
GROUP BY 市级
ORDER BY 清洗率 DESC;
```

### SQL 查询 3：查看预处理后的村名

```sql
SELECT
    市级, 区县级, 乡镇级, 行政村,
    自然村 AS 原始名称,
    自然村_基础清洗 AS 基础清洗后,
    自然村_去前缀 AS 去前缀后,
    自然村_规范化 AS 最终规范化,
    字符集,
    字符数量
FROM 广东省自然村_预处理
WHERE 有效 = 1
LIMIT 100;
```

---

## 数据质量保证

### 保守匹配策略

1. **长度保护：** 村名长度 ≤3 字符时不尝试去除前缀
2. **置信度阈值：** 仅当置信度 ≥0.7 时自动去除
3. **仅去除前缀：** 绝不去除内部子串
4. **跨市消歧：** 所有匹配在同一地理层级内进行

### 可审计性

- 每个村庄的处理过程完全可追溯
- 记录了匹配来源、置信度、去除的前缀
- 支持人工审核低置信度案例

---

## 下一步建议

### 可选：重新运行分析

如果前缀清洗效果显著，可考虑重新运行以下分析阶段：

```bash
# Phase 1: 字符频率分析
python scripts/phase1_frequency_analysis.py

# Phase 2: 区域倾向性分析
python scripts/phase2_regional_tendency.py

# Phase 8: Z-score 标准化
python scripts/phase8_zscore_normalization.py

# Phase 9: 统计显著性检验
python scripts/phase9_significance_testing.py
```

### 可选：人工审核

对于 804 个需要审核的案例，可以：
1. 导出到 CSV 文件
2. 人工标注正确/错误
3. 改进匹配算法
4. 重新运行预处理

---

## 技术细节

### 处理流程

1. **基础文本清洗：** 去除括号、噪音字符（285,860 个村庄，9 秒）
2. **行政村前缀去除：** 检测并去除冗余前缀（284,764 个村庄，48 秒）
3. **编号村规范化：** 规范化中文数字后缀（285,860 个村庄，11 秒）
4. **字符集提取：** 提取 set() 去重后的字符（285,860 个村庄，10 秒）
5. **写入数据库：** 存储所有结果（6 秒）

**总时间：** 1 分 24 秒

### 数据库表

- **广东省自然村_预处理：** 285,860 行（预处理结果）
- **prefix_cleaning_audit_log：** 284,764 行（审计日志）

---

## 参考文档

- **完整审计报告：** `docs/PREFIX_CLEANING_AUDIT_REPORT.md`
- **预处理技术文档：** `docs/PHASE_0_PREPROCESSING_SUMMARY.md`
- **快速开始指南：** `docs/PREPROCESSING_QUICK_START.md`
- **实现总结：** `docs/IMPLEMENTATION_COMPLETE.md`
